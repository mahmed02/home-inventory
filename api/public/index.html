<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home Inventory</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&family=Space+Grotesk:wght@500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <main class="site-shell">
      <header class="topbar panel">
        <div class="brand-block">
          <button id="brandHomeBtn" class="brand-btn" type="button">Home Inventory</button>
          <p class="hint">Know exactly where everything is.</p>
        </div>
        <div class="topbar-actions">
          <span id="globalAuthBadge" class="auth-badge">Guest</span>
          <button id="goToAuthBtn" type="button" class="button-subtle">Sign In</button>
          <button id="goToInventoryBtn" type="button" class="button-subtle" hidden>Open Inventory</button>
          <button id="logoutTopBtn" type="button" class="button-danger" hidden>Sign Out</button>
        </div>
      </header>

      <section id="landingView" class="view landing-view">
        <section class="panel hero-panel">
          <p class="eyebrow">Simple, shared home organization</p>
          <h1>Track your household inventory with one clean workspace.</h1>
          <p class="hero-copy">
            Search items instantly, ask where something is, and keep one source of truth for everyone in the home.
          </p>
          <div class="hero-actions">
            <button id="startLoginBtn" type="button">Sign In</button>
            <button id="startSignupBtn" type="button" class="button-subtle">Create Account</button>
            <button id="startInventoryBtn" type="button" class="button-subtle" hidden>Go to Inventory</button>
          </div>
        </section>

        <section class="landing-grid">
          <article class="panel feature-card">
            <h2>Fast Search</h2>
            <p>Find items by keyword, semantic match, or assistant query.</p>
          </article>
          <article class="panel feature-card">
            <h2>Household Sharing</h2>
            <p>Invite owners, editors, and viewers with role-based access.</p>
          </article>
          <article class="panel feature-card">
            <h2>Accurate History</h2>
            <p>Track where items moved and verify expected vs actual locations.</p>
          </article>
        </section>
      </section>

      <section id="authView" class="view auth-view" hidden>
        <section class="panel auth-shell">
          <div class="panel-head">
            <div class="stack auth-head-copy">
              <h2>Account Access</h2>
              <p class="hint">Sign in or create an account to open your inventory workspace.</p>
            </div>
            <button id="authBackBtn" type="button" class="button-subtle">Back</button>
          </div>

          <section id="authPanel" class="stack auth-panel">
            <div class="panel-head compact-head">
              <h3>Session</h3>
              <span id="authStateHint" class="hint">Not signed in</span>
            </div>

            <div id="authLoggedOut" class="stack">
              <div class="auth-grid">
                <form id="loginForm" class="stack auth-card">
                  <h3>Login</h3>
                  <input id="loginEmail" type="email" placeholder="Email" required />
                  <input id="loginPassword" type="password" placeholder="Password" required />
                  <button type="submit">Sign In</button>
                </form>

                <form id="registerForm" class="stack auth-card">
                  <h3>Create Account</h3>
                  <input id="registerDisplayName" type="text" placeholder="Display name (optional)" />
                  <input id="registerEmail" type="email" placeholder="Email" required />
                  <input
                    id="registerPassword"
                    type="password"
                    placeholder="Password (min 8 chars)"
                    required
                  />
                  <button type="submit">Sign Up</button>
                </form>
              </div>

              <details class="auth-recovery">
                <summary>Password recovery</summary>
                <div class="auth-grid auth-grid-recovery">
                  <form id="forgotPasswordForm" class="stack auth-card">
                    <h3>Forgot Password</h3>
                    <input id="forgotEmail" type="email" placeholder="Email" required />
                    <button type="submit">Generate Reset Token</button>
                    <p class="hint">Token is returned directly for now (email delivery not yet wired).</p>
                  </form>

                  <form id="resetPasswordForm" class="stack auth-card">
                    <h3>Reset Password</h3>
                    <input id="resetToken" type="text" placeholder="Reset token" required />
                    <input id="resetNewPassword" type="password" placeholder="New password" required />
                    <button type="submit">Reset Password</button>
                  </form>
                </div>
              </details>
            </div>

            <div id="authLoggedIn" class="stack" hidden>
              <p>Signed in as <strong id="authUserEmail">-</strong></p>
              <div class="actions-row">
                <button id="authOpenInventoryBtn" type="button">Open Inventory</button>
                <button id="logoutBtn" type="button" class="button-danger">Sign Out</button>
              </div>
            </div>
          </section>
        </section>
      </section>

      <section id="inventoryView" class="view inventory-view" hidden>
        <section class="panel workspace-panel">
          <div>
            <h2>Inventory Workspace</h2>
            <p class="hint">Manage inventory, sharing, and assistant lookup from one place.</p>
          </div>
          <button id="workspaceRefreshBtn" type="button" class="button-subtle">Refresh Workspace</button>
        </section>

        <section id="householdPanel" class="panel" hidden>
          <div class="panel-head">
            <h2>Household Sharing</h2>
            <div class="actions-row">
              <button id="refreshHouseholdsBtn" type="button">Refresh</button>
            </div>
          </div>
          <ol class="setup-list">
            <li>Create a household as the owner account.</li>
            <li>Invite another account by email with a role.</li>
            <li>Sign in as that account and accept using the invitation token.</li>
            <li>Owners can later change roles or remove members.</li>
          </ol>

          <div class="household-top">
            <div class="stack">
              <label for="householdSelect">Active Household</label>
              <select id="householdSelect">
                <option value="">No household selected</option>
              </select>
              <p id="householdRoleHint" class="hint"></p>
            </div>

            <form id="createHouseholdForm" class="stack household-create">
              <h3>Create Household</h3>
              <input id="createHouseholdName" type="text" placeholder="Household name" />
              <button type="submit">Create Household</button>
            </form>
          </div>

          <div class="household-grid">
            <div class="stack">
              <form id="inviteMemberForm" class="stack household-invite">
                <h3>Invite Member</h3>
                <input id="inviteEmail" type="email" placeholder="Email" required />
                <select id="inviteRole">
                  <option value="viewer">Viewer</option>
                  <option value="editor">Editor</option>
                  <option value="owner">Owner</option>
                </select>
                <button id="inviteMemberBtn" type="submit">Send Invite</button>
                <p id="inviteTokenHint" class="hint"></p>
                <button id="copyInviteTokenBtn" type="button" hidden>Copy Invite Token</button>
              </form>

              <form id="acceptInviteForm" class="stack household-invite">
                <h3>Accept Invitation</h3>
                <input id="acceptInviteToken" type="text" placeholder="Invitation token" required />
                <button id="acceptInviteBtn" type="submit">Accept Invite</button>
                <p class="hint">Use the account that matches the invited email address.</p>
              </form>

              <div class="stack">
                <h3>Pending Invitations</h3>
                <ul id="householdInvitations" class="management-list"></ul>
              </div>
            </div>

            <div class="stack">
              <h3>Members</h3>
              <ul id="householdMembers" class="management-list"></ul>
            </div>
          </div>
        </section>

        <section class="panel">
          <h2>Search</h2>
          <div class="search-row">
            <input id="query" type="text" placeholder="air compressor" />
            <select id="searchMode" title="Search mode">
              <option value="lexical">Lexical</option>
              <option value="hybrid">Hybrid</option>
              <option value="semantic">Semantic</option>
            </select>
            <button id="searchBtn">Search</button>
          </div>
          <p class="hint">Switch between exact keyword matching, semantic similarity, or blended ranking.</p>
        </section>

        <section class="panel">
          <h2>Ask Inventory Assistant</h2>
          <div class="search-row">
            <input id="chatQuery" type="text" placeholder="Where is my drill?" />
            <button id="chatAskBtn">Ask</button>
            <button id="chatClearBtn" type="button" class="button-subtle">Clear</button>
          </div>
          <ul id="chatHistory" class="chat-history"></ul>
        </section>

        <section class="panel">
          <div class="panel-head">
            <h2>Results</h2>
            <span id="meta"></span>
          </div>
          <ul id="results" class="results"></ul>
        </section>

        <section class="panel">
          <div class="panel-head">
            <h2>Inventory Tree</h2>
            <div class="actions-row">
              <button id="openCreateActionsBtn" class="plus-btn" title="Create">+</button>
              <button id="openEditBtn" disabled>Edit Selected</button>
              <button id="refreshTreeBtn">Refresh Tree</button>
              <button id="seedBtn">Seed Demo Data</button>
            </div>
          </div>
          <p id="selectionHint" class="hint">Select a location or item in the tree to edit.</p>
          <p id="treeMeta" class="hint"></p>
          <div id="treeView" class="tree-view"></div>
          <pre id="treeText" class="tree"></pre>
        </section>

        <section id="verificationPanel" class="panel" hidden>
          <div class="panel-head">
            <h2>Verification Mode</h2>
            <div class="actions-row">
              <button id="refreshVerificationBtn" type="button">Refresh Checklist</button>
              <button id="exportDiscrepanciesBtn" type="button">Export Missing CSV</button>
            </div>
          </div>
          <p id="verificationSummary" class="hint">Select a location to verify expected vs actual items.</p>
          <ul id="verificationList" class="management-list"></ul>
        </section>
      </section>

      <p id="status" class="status"></p>
    </main>

    <section id="createActionsModal" class="modal-overlay" hidden>
      <div class="modal-card modal-small">
        <div class="modal-head">
          <h2>Create</h2>
          <button type="button" class="modal-close" data-modal-close="createActionsModal">x</button>
        </div>
        <div class="stack">
          <button type="button" id="actionCreateLocationBtn">Add Location</button>
          <button type="button" id="actionCreateItemBtn">Add Item</button>
        </div>
      </div>
    </section>

    <section id="createLocationModal" class="modal-overlay" hidden>
      <div class="modal-card">
        <div class="modal-head">
          <h2>Create Location</h2>
          <button type="button" class="modal-close" data-modal-close="createLocationModal">x</button>
        </div>
        <form id="createLocationForm" class="stack">
          <input id="locName" type="text" placeholder="Name" required />
          <input id="locCode" type="text" placeholder="Code (optional)" />
          <input id="locType" type="text" placeholder="Type (room, shelf...)" />
          <input id="locImageUrl" type="url" placeholder="Image URL (optional)" />
          <div class="upload-row">
            <input id="locImageFile" type="file" accept="image/*" />
            <button type="button" id="uploadLocImageBtn">Upload Image</button>
          </div>
          <select id="locParentId">
            <option value="">No parent (root)</option>
          </select>
          <button type="submit">Create Location</button>
        </form>
      </div>
    </section>

    <section id="createItemModal" class="modal-overlay" hidden>
      <div class="modal-card">
        <div class="modal-head">
          <h2>Create Item</h2>
          <button type="button" class="modal-close" data-modal-close="createItemModal">x</button>
        </div>
        <form id="createItemForm" class="stack">
          <input id="itemName" type="text" placeholder="Name" required />
          <input id="itemDescription" type="text" placeholder="Description (optional)" />
          <input id="itemQuantity" type="number" min="0" step="1" placeholder="Quantity (optional)" />
          <input id="itemKeywords" type="text" placeholder="Keywords comma-separated" />
          <input id="itemImageUrl" type="url" placeholder="Image URL (optional)" />
          <div class="upload-row">
            <input id="itemImageFile" type="file" accept="image/*" />
            <button type="button" id="uploadItemImageBtn">Upload Image</button>
          </div>
          <select id="itemLocationId" required>
            <option value="">Select location</option>
          </select>
          <button type="submit">Create Item</button>
        </form>
      </div>
    </section>

    <section id="editLocationModal" class="modal-overlay" hidden>
      <div class="modal-card">
        <div class="modal-head">
          <h2>Edit Location</h2>
          <button type="button" class="modal-close" data-modal-close="editLocationModal">x</button>
        </div>
        <p id="locationEditorHint" class="hint">Select a location in the tree.</p>
        <p id="locationBreadcrumb" class="crumb"></p>
        <form id="editLocationForm" class="stack" hidden>
          <input id="editLocName" type="text" placeholder="Name" required />
          <input id="editLocCode" type="text" placeholder="Code (optional)" />
          <input id="editLocType" type="text" placeholder="Type" />
          <input id="editLocDescription" type="text" placeholder="Description" />
          <input id="editLocImageUrl" type="url" placeholder="Image URL" />
          <div class="upload-row">
            <input id="editLocImageFile" type="file" accept="image/*" />
            <button type="button" id="uploadEditLocImageBtn">Upload Image</button>
          </div>
          <select id="editLocParentId">
            <option value="">No parent (root)</option>
          </select>
          <div class="button-row">
            <button type="submit">Update Location</button>
            <button type="button" id="deleteLocationBtn" class="button-danger">Delete Location</button>
          </div>
        </form>
      </div>
    </section>

    <section id="moveImpactModal" class="modal-overlay" hidden>
      <div class="modal-card">
        <div class="modal-head">
          <h2>Confirm Location Move</h2>
          <button type="button" class="modal-close" data-modal-close="moveImpactModal">x</button>
        </div>
        <p id="moveImpactSummary" class="hint"></p>
        <ul id="moveImpactSample" class="management-list"></ul>
        <div class="button-row">
          <button type="button" id="confirmMoveImpactBtn">Confirm Move</button>
          <button type="button" id="cancelMoveImpactBtn" class="button-danger">Cancel</button>
        </div>
      </div>
    </section>

    <section id="editItemModal" class="modal-overlay" hidden>
      <div class="modal-card">
        <div class="modal-head">
          <h2>Edit Item</h2>
          <button type="button" class="modal-close" data-modal-close="editItemModal">x</button>
        </div>
        <p id="itemEditorHint" class="hint">Select an item in the tree.</p>
        <p id="itemBreadcrumb" class="crumb"></p>
        <section id="itemHistoryPanel" class="stack item-history-panel" hidden>
          <div class="panel-head">
            <h3>Movement History</h3>
            <button id="refreshItemHistoryBtn" type="button">Refresh</button>
          </div>
          <ul id="itemHistoryList" class="management-list"></ul>
        </section>
        <form id="editItemForm" class="stack" hidden>
          <input id="editItemName" type="text" placeholder="Name" required />
          <input id="editItemDescription" type="text" placeholder="Description" />
          <input id="editItemQuantity" type="number" min="0" step="1" placeholder="Quantity (optional)" />
          <input id="editItemKeywords" type="text" placeholder="Keywords comma-separated" />
          <input id="editItemImageUrl" type="url" placeholder="Image URL" />
          <div class="upload-row">
            <input id="editItemImageFile" type="file" accept="image/*" />
            <button type="button" id="uploadEditItemImageBtn">Upload Image</button>
          </div>
          <select id="editItemLocationId" required>
            <option value="">Select location</option>
          </select>
          <div class="button-row">
            <button type="submit">Update Item</button>
            <button type="button" id="deleteItemBtn" class="button-danger">Delete Item</button>
          </div>
        </form>
      </div>
    </section>

    <section id="imageLightboxModal" class="modal-overlay" hidden>
      <div class="modal-card modal-image">
        <div class="modal-head">
          <h2>Image Preview</h2>
          <button type="button" class="modal-close" data-modal-close="imageLightboxModal">x</button>
        </div>
        <img id="imageLightboxImg" class="lightbox-img" alt="" />
        <p id="imageLightboxCaption" class="hint"></p>
      </div>
    </section>

    <script src="/app.js" defer></script>
  </body>
</html>
